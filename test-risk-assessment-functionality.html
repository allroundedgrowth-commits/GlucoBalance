<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Risk Assessment Functionality Test</title>
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/components.css">
    <link rel="stylesheet" href="styles/dashboard-cards-enhanced.css">
    <style>
        body {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            min-height: 100vh;
            padding: 20px 0;
        }
        
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .test-header {
            text-align: center;
            margin-bottom: 40px;
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 127, 255, 0.1);
        }
        
        .test-header h1 {
            background: linear-gradient(135deg, #ef4444, #f87171);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .test-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin: 20px 0;
        }
        
        .test-btn {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 16px rgba(239, 68, 68, 0.3);
        }
        
        .test-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(239, 68, 68, 0.4);
        }
        
        .status-info {
            background: rgba(239, 68, 68, 0.1);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid #ef4444;
        }
        
        .dashboard-main {
            margin-top: 0;
        }
        
        .single-card-grid {
            display: flex;
            justify-content: center;
            margin: 2rem 0;
        }
        
        .single-card-grid .card {
            max-width: 400px;
            width: 100%;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>üéØ Risk Assessment Test</h1>
            <p>Test the Risk Status card button functionality and questionnaire.</p>
            
            <div class="test-controls">
                <button class="test-btn" onclick="testButtonConnection()">üîç Test Button Connection</button>
                <button class="test-btn" onclick="testQuestionnaire()">üìã Test Questionnaire</button>
                <button class="test-btn" onclick="simulateAssessment()">üéØ Simulate Assessment</button>
                <button class="test-btn" onclick="clearResults()">üóëÔ∏è Clear Results</button>
            </div>
            
            <div class="status-info">
                <strong>Test Status:</strong> <span id="test-status">Ready to test</span><br>
                <strong>Button Status:</strong> <span id="button-status">Checking...</span><br>
                <strong>Last Action:</strong> <span id="last-action">None</span>
            </div>
        </div>

        <!-- Risk Status Card -->
        <main class="container dashboard-main">
            <div class="single-card-grid">
                <div class="card risk-status-card interactive-card">
                    <div class="card-header">
                        <h3><span class="card-icon">üéØ</span> Risk Status</h3>
                        <div class="card-trend" id="risk-trend">
                            <span class="trend-icon">üìà</span> Ready
                        </div>
                    </div>
                    <div class="card-content">
                        <div id="risk-display" class="risk-display">
                            <div class="risk-score" id="risk-score-display">--</div>
                            <div class="risk-category" id="risk-category-display">Take Assessment</div>
                            <div class="risk-details">
                                <small class="last-updated" id="last-updated-display">Never assessed</small>
                            </div>
                        </div>
                        <div class="risk-chart-mini" id="risk-chart-mini">
                            <!-- Mini chart visualization -->
                            <div style="height: 40px; background: linear-gradient(90deg, #ef4444, #f87171); border-radius: 8px; opacity: 0.3; margin-top: 15px;"></div>
                        </div>
                    </div>
                    <div class="card-actions">
                        <button class="btn-card-action" id="take-assessment-btn">
                            üìã Take Assessment
                        </button>
                    </div>
                </div>
            </div>
        </main>
        
        <!-- Test Results -->
        <div class="test-header">
            <h3>üìä Test Results</h3>
            <div id="test-results" style="background: #f8f9fa; border-radius: 8px; padding: 15px; margin-top: 15px; font-family: monospace; font-size: 12px; text-align: left; max-height: 200px; overflow-y: auto;">
                Risk Assessment functionality test initialized...<br>
                Ready to test button and questionnaire.<br>
                <br>
            </div>
        </div>
    </div>

    <!-- Include necessary scripts -->
    <script src="js/demo-data-generator.js"></script>
    <script src="js/dashboard-ai-service.js"></script>
    <script src="js/navigation-manager.js"></script>
    <script src="dashboard-buttons-fix.js"></script>

    <script>
        function logTest(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const colors = {
                'success': '#22c55e',
                'error': '#ef4444',
                'warning': '#f59e0b',
                'info': '#3b82f6'
            };
            
            const entry = `[${timestamp}] ${message}`;
            
            const logContainer = document.getElementById('test-results');
            logContainer.innerHTML += `<span style="color: ${colors[type]}">${entry}</span><br>`;
            logContainer.scrollTop = logContainer.scrollHeight;
            
            console.log(entry);
            
            // Update last action
            document.getElementById('last-action').textContent = message;
        }
        
        function updateStatus(status) {
            document.getElementById('test-status').textContent = status;
        }
        
        function testButtonConnection() {
            logTest('üîç Testing button connection...', 'info');
            updateStatus('Testing button connection');
            
            const button = document.getElementById('take-assessment-btn');
            if (button) {
                logTest('‚úÖ Take Assessment button found in DOM', 'success');
                
                // Check if button has event listeners
                if (window.dashboardButtonsFix) {
                    logTest('‚úÖ Dashboard buttons fix service available', 'success');
                    
                    // Test button click programmatically
                    try {
                        button.click();
                        logTest('‚úÖ Button click triggered successfully', 'success');
                        document.getElementById('button-status').textContent = 'Working';
                        updateStatus('Button connection test passed');
                    } catch (error) {
                        logTest('‚ùå Button click failed: ' + error.message, 'error');
                        document.getElementById('button-status').textContent = 'Error';
                        updateStatus('Button connection test failed');
                    }
                } else {
                    logTest('‚ùå Dashboard buttons fix service not available', 'error');
                    document.getElementById('button-status').textContent = 'Service Missing';
                    updateStatus('Service not available');
                }
            } else {
                logTest('‚ùå Take Assessment button not found', 'error');
                document.getElementById('button-status').textContent = 'Missing';
                updateStatus('Button not found');
            }
        }
        
        function testQuestionnaire() {
            logTest('üìã Testing questionnaire functionality...', 'info');
            updateStatus('Testing questionnaire');
            
            if (window.dashboardButtonsFix && typeof window.dashboardButtonsFix.handleTakeAssessment === 'function') {
                try {
                    window.dashboardButtonsFix.handleTakeAssessment();
                    logTest('‚úÖ Risk assessment questionnaire opened', 'success');
                    updateStatus('Questionnaire test passed');
                } catch (error) {
                    logTest('‚ùå Questionnaire failed to open: ' + error.message, 'error');
                    updateStatus('Questionnaire test failed');
                }
            } else {
                logTest('‚ùå Risk assessment handler not available', 'error');
                updateStatus('Handler not available');
            }
        }
        
        function simulateAssessment() {
            logTest('üéØ Simulating complete assessment...', 'info');
            updateStatus('Simulating assessment');
            
            // Simulate assessment results
            const simulatedScore = Math.floor(Math.random() * 15) + 1; // 1-15 scale
            let category, color;
            
            if (simulatedScore < 3) {
                category = 'Low Risk';
                color = '#22c55e';
            } else if (simulatedScore < 6) {
                category = 'Increased Risk';
                color = '#f59e0b';
            } else if (simulatedScore < 9) {
                category = 'High Risk';
                color = '#ef4444';
            } else {
                category = 'Very High Risk';
                color = '#dc2626';
            }
            
            // Update card display
            const scoreDisplay = document.getElementById('risk-score-display');
            const categoryDisplay = document.getElementById('risk-category-display');
            const lastUpdatedDisplay = document.getElementById('last-updated-display');
            
            if (scoreDisplay && categoryDisplay && lastUpdatedDisplay) {
                // Animate score change
                animateNumber(scoreDisplay, simulatedScore);
                
                setTimeout(() => {
                    categoryDisplay.textContent = category;
                    categoryDisplay.style.color = color;
                    lastUpdatedDisplay.textContent = `Assessed: ${new Date().toLocaleTimeString()}`;
                    
                    logTest(`‚úÖ Assessment completed: Score ${simulatedScore} (${category})`, 'success');
                    updateStatus('Assessment simulation completed');
                }, 1000);
            }
        }
        
        function animateNumber(element, targetValue) {
            const startValue = 0;
            const duration = 1000;
            const startTime = performance.now();
            
            function updateNumber(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                // Easing function
                const easeOutQuart = 1 - Math.pow(1 - progress, 4);
                const currentValue = startValue + (targetValue - startValue) * easeOutQuart;
                
                element.textContent = Math.round(currentValue);
                
                if (progress < 1) {
                    requestAnimationFrame(updateNumber);
                }
            }
            
            requestAnimationFrame(updateNumber);
        }
        
        function clearResults() {
            logTest('üóëÔ∏è Clearing assessment results...', 'info');
            updateStatus('Clearing results');
            
            // Reset displays
            document.getElementById('risk-score-display').textContent = '--';
            document.getElementById('risk-category-display').textContent = 'Take Assessment';
            document.getElementById('risk-category-display').style.color = '';
            document.getElementById('last-updated-display').textContent = 'Never assessed';
            
            // Clear test log
            document.getElementById('test-results').innerHTML = 'Test results cleared...<br><br>';
            
            logTest('‚úÖ Results cleared successfully', 'success');
            updateStatus('Ready to test');
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            logTest('üöÄ Risk Assessment test page loaded', 'success');
            
            // Check service availability
            logTest('üîß Dashboard Buttons Fix: ' + (window.dashboardButtonsFix ? 'Available' : 'Not Available'), 
                   window.dashboardButtonsFix ? 'success' : 'error');
            
            // Auto-test button connection
            setTimeout(() => {
                const button = document.getElementById('take-assessment-btn');
                if (button) {
                    document.getElementById('button-status').textContent = 'Found';
                    logTest('‚úÖ Take Assessment button detected', 'success');
                } else {
                    document.getElementById('button-status').textContent = 'Not Found';
                    logTest('‚ùå Take Assessment button not detected', 'error');
                }
            }, 1000);
        });
    </script>
</body>
</html>