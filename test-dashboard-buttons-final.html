<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Final Dashboard Buttons Test</title>
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/components.css">
    <link rel="stylesheet" href="styles/dashboard-cards-enhanced.css">
    <style>
        body {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            min-height: 100vh;
            padding: 20px 0;
        }
        
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .test-header {
            text-align: center;
            margin-bottom: 40px;
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 127, 255, 0.1);
        }
        
        .test-header h1 {
            background: linear-gradient(135deg, #007FFF, #40E0FF);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .status-indicator {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            margin: 10px;
        }
        
        .status-excellent {
            background: #22c55e;
            color: white;
        }
        
        .status-good {
            background: #f59e0b;
            color: white;
        }
        
        .status-needs-attention {
            background: #ef4444;
            color: white;
        }
        
        .dashboard-simulation {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }
        
        .test-results {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }
        
        .button-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .test-button {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .test-button.working {
            background: linear-gradient(135deg, #22c55e, #16a34a);
            color: white;
        }
        
        .test-button.broken {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }
        
        .test-button.testing {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .console-mini {
            background: #1a1a1a;
            color: #00ff00;
            border-radius: 8px;
            padding: 15px;
            max-height: 200px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>üéØ Final Dashboard Buttons Test</h1>
            <p>Comprehensive verification that all dashboard buttons are functioning properly.</p>
            <div id="overall-status">
                <span class="status-indicator" id="status-badge">Checking...</span>
            </div>
        </div>

        <div class="test-results">
            <h3>üìä Test Results</h3>
            <div id="test-summary">Running tests...</div>
            
            <div class="button-grid" id="button-tests">
                <!-- Buttons will be populated by JavaScript -->
            </div>
            
            <div class="console-mini" id="mini-console">
                Initializing tests...<br>
            </div>
        </div>

        <div class="dashboard-simulation">
            <h3>üñ•Ô∏è Live Dashboard Simulation</h3>
            <p>This simulates the actual dashboard environment. All buttons below should work exactly like in the real dashboard.</p>
            
            <!-- Simulate the actual dashboard structure -->
            <div class="dashboard-grid">
                <!-- Risk Status Card -->
                <div class="card risk-status-card">
                    <div class="card-header">
                        <h3><span class="card-icon">üéØ</span> Risk Status</h3>
                    </div>
                    <div class="card-content">
                        <div class="risk-display">
                            <div class="risk-score">--</div>
                            <div class="risk-category">Take Assessment</div>
                        </div>
                    </div>
                    <div class="card-actions">
                        <button class="btn-card-action" id="take-assessment-btn">
                            üìã Take Assessment
                        </button>
                    </div>
                </div>

                <!-- Mood Tracker Card -->
                <div class="card mood-tracker-card">
                    <div class="card-header">
                        <h3><span class="card-icon">üíô</span> Mood Tracker</h3>
                    </div>
                    <div class="card-content">
                        <div class="mood-display">
                            <div class="current-mood">
                                <div class="mood-value">--</div>
                                <div class="mood-label">Today's Mood</div>
                            </div>
                        </div>
                    </div>
                    <div class="card-actions">
                        <button class="btn-card-action" id="log-mood-btn">
                            üíô Log Mood
                        </button>
                        <button class="btn-card-action secondary" id="view-mood-history-btn">
                            üìà View History
                        </button>
                    </div>
                </div>

                <!-- Nutrition Card -->
                <div class="card nutrition-snapshot-card">
                    <div class="card-header">
                        <h3><span class="card-icon">üçé</span> Nutrition Snapshot</h3>
                    </div>
                    <div class="card-content">
                        <div class="nutrition-stats">
                            <div class="stat-item">
                                <div class="stat-value">0</div>
                                <div class="stat-label">Meal Plans</div>
                            </div>
                        </div>
                    </div>
                    <div class="card-actions">
                        <button class="btn-card-action" id="create-meal-plan-btn">
                            üçΩÔ∏è Create Plan
                        </button>
                        <button class="btn-card-action secondary" id="view-nutrition-btn">
                            üìã View Plans
                        </button>
                    </div>
                </div>

                <!-- AI Insights Card -->
                <div class="card ai-insights-card">
                    <div class="card-header">
                        <h3><span class="card-icon">ü§ñ</span> AI Health Insights</h3>
                    </div>
                    <div class="card-content">
                        <div class="insights-placeholder">
                            <div class="placeholder-icon">ü§ñ</div>
                            <p>Click Get Started to generate AI insights</p>
                            <button class="btn-primary" id="get-started-insights-btn" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed); border: none; padding: 10px 20px; border-radius: 10px; color: white; margin-top: 10px;">
                                Get Started
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Navigation simulation -->
            <div style="margin-top: 30px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                <h4>üß≠ Navigation Test</h4>
                <button class="btn-secondary" id="nav-logout-btn" style="margin: 5px;">
                    üö™ Logout
                </button>
                <button class="btn-secondary" id="nav-dashboard-btn" style="margin: 5px;">
                    üìä Dashboard
                </button>
            </div>
        </div>
    </div>

    <!-- Include all necessary scripts -->
    <script src="js/demo-data-generator.js"></script>
    <script src="js/dashboard-ai-service.js"></script>
    <script src="js/navigation-manager.js"></script>
    <script src="dashboard-buttons-fix.js"></script>
    <script src="js/dashboard-diagnostics.js"></script>
    <script src="verify-dashboard-buttons-quick.js"></script>

    <script>
        function logToMiniConsole(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const colors = {
                'success': '#00ff00',
                'error': '#ff4444', 
                'warning': '#ffaa00',
                'info': '#00aaff'
            };
            
            const entry = `[${timestamp}] ${message}`;
            
            const console = document.getElementById('mini-console');
            console.innerHTML += `<span style="color: ${colors[type]}">${entry}</span><br>`;
            console.scrollTop = console.scrollHeight;
        }

        function updateOverallStatus(status) {
            const badge = document.getElementById('status-badge');
            badge.className = `status-indicator status-${status}`;
            
            const statusText = {
                'excellent': '‚úÖ All Systems Working',
                'good': '‚ö†Ô∏è Minor Issues Detected',
                'needs_attention': '‚ùå Issues Need Attention',
                'checking': 'üîç Running Tests...'
            };
            
            badge.textContent = statusText[status] || 'Unknown Status';
        }

        function createButtonTest(buttonId, buttonName) {
            const button = document.createElement('button');
            button.className = 'test-button';
            button.textContent = buttonName;
            button.id = `test-${buttonId}`;
            
            button.onclick = () => testSingleButton(buttonId);
            
            return button;
        }

        function testSingleButton(buttonId) {
            const testButton = document.getElementById(`test-${buttonId}`);
            const actualButton = document.getElementById(buttonId);
            
            if (!actualButton) {
                logToMiniConsole(`‚ùå Button ${buttonId} not found`, 'error');
                if (testButton) testButton.className = 'test-button broken';
                return false;
            }
            
            logToMiniConsole(`üß™ Testing ${buttonId}...`, 'info');
            if (testButton) testButton.className = 'test-button testing';
            
            try {
                // Visual feedback on actual button
                actualButton.style.transform = 'scale(1.05)';
                actualButton.style.boxShadow = '0 0 15px rgba(0, 127, 255, 0.6)';
                actualButton.style.transition = 'all 0.3s ease';
                
                // Test click
                actualButton.click();
                
                logToMiniConsole(`‚úÖ ${buttonId} working`, 'success');
                if (testButton) testButton.className = 'test-button working';
                
                // Reset visual feedback
                setTimeout(() => {
                    actualButton.style.transform = '';
                    actualButton.style.boxShadow = '';
                }, 1000);
                
                return true;
                
            } catch (error) {
                logToMiniConsole(`‚ùå ${buttonId} failed: ${error.message}`, 'error');
                if (testButton) testButton.className = 'test-button broken';
                return false;
            }
        }

        async function runComprehensiveTest() {
            logToMiniConsole('üîç Starting comprehensive button test...', 'info');
            updateOverallStatus('checking');
            
            const buttonsToTest = [
                { id: 'take-assessment-btn', name: 'üìã Take Assessment' },
                { id: 'log-mood-btn', name: 'üíô Log Mood' },
                { id: 'view-mood-history-btn', name: 'üìà View History' },
                { id: 'create-meal-plan-btn', name: 'üçΩÔ∏è Create Plan' },
                { id: 'view-nutrition-btn', name: 'üìã View Plans' },
                { id: 'get-started-insights-btn', name: 'ü§ñ Get Started' },
                { id: 'nav-logout-btn', name: 'üö™ Logout' },
                { id: 'nav-dashboard-btn', name: 'üìä Dashboard' }
            ];
            
            // Create test buttons
            const buttonGrid = document.getElementById('button-tests');
            buttonGrid.innerHTML = '';
            
            buttonsToTest.forEach(btn => {
                const testButton = createButtonTest(btn.id, btn.name);
                buttonGrid.appendChild(testButton);
            });
            
            // Test each button
            let workingButtons = 0;
            let totalButtons = buttonsToTest.length;
            
            for (let i = 0; i < buttonsToTest.length; i++) {
                const btn = buttonsToTest[i];
                const isWorking = testSingleButton(btn.id);
                if (isWorking) workingButtons++;
                
                // Small delay between tests
                await new Promise(resolve => setTimeout(resolve, 500));
            }
            
            // Calculate overall status
            const successRate = workingButtons / totalButtons;
            let overallStatus;
            
            if (successRate >= 0.9) {
                overallStatus = 'excellent';
            } else if (successRate >= 0.7) {
                overallStatus = 'good';
            } else {
                overallStatus = 'needs_attention';
            }
            
            updateOverallStatus(overallStatus);
            
            // Update summary
            const summary = document.getElementById('test-summary');
            summary.innerHTML = `
                <div style="font-size: 1.1rem; margin-bottom: 15px;">
                    <strong>Test Results: ${workingButtons}/${totalButtons} buttons working (${(successRate * 100).toFixed(1)}%)</strong>
                </div>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                    <div>‚úÖ Working: ${workingButtons}</div>
                    <div>‚ùå Broken: ${totalButtons - workingButtons}</div>
                    <div>üìä Success Rate: ${(successRate * 100).toFixed(1)}%</div>
                    <div>üéØ Status: ${overallStatus.replace('_', ' ').toUpperCase()}</div>
                </div>
            `;
            
            logToMiniConsole(`üìä Test completed: ${workingButtons}/${totalButtons} working`, 
                successRate === 1 ? 'success' : 'warning');
            
            // Auto-fix if needed
            if (successRate < 1) {
                logToMiniConsole('üîß Attempting auto-fix...', 'info');
                
                if (window.dashboardDiagnostics) {
                    window.dashboardDiagnostics.forceInitializeButtons();
                    logToMiniConsole('‚úÖ Applied diagnostic fixes', 'success');
                    
                    // Re-test after fix
                    setTimeout(() => {
                        logToMiniConsole('üîÑ Re-testing after fixes...', 'info');
                        runComprehensiveTest();
                    }, 2000);
                }
            }
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', () => {
            logToMiniConsole('üöÄ Final dashboard button test initialized', 'success');
            
            // Wait for all scripts to load
            setTimeout(() => {
                runComprehensiveTest();
            }, 2000);
        });
    </script>
</body>
</html>